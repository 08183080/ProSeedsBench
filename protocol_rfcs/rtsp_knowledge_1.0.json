{
  "meta": {
    "protocol": "RTSP",
    "rfc_source": "RFC 2326"
  },
  "constants": {
    "transport": [
      "TCP",
      "UDP"
    ],
    "default_port": 554,
    "delimiters": [
      "<CRLF>",
      "<SP>",
      "<HT>",
      "<DoubleCRLF>"
    ],
    "special_tokens": [
      "$",
      "RTSP/1.0",
      "RTSP/2.0"
    ],
    "magic_bytes": {
      "interleaved_binary": "0x24"
    }
  },
  "syntax_definitions": [
    {
      "name": "session-id",
      "abnf": "1*( ALPHA | DIGIT | safe )",
      "constraint": "Arbitrary length, randomly chosen, MUST be at least 8 octets long .",
      "fuzz_strategy": "Inject short strings (<8 chars), extremely long strings, or non-safe characters to test ID validation logic."
    },
    {
      "name": "CSeq",
      "abnf": "1*DIGIT",
      "constraint": "Sequence number, incremented by one for each distinct request .",
      "fuzz_strategy": "Integer overflow, negative numbers, or non-sequential jumps to test state tracking."
    },
    {
      "name": "Transport",
      "abnf": "transport-protocol/profile[/lower-transport] *parameter",
      "constraint": "Complex structured header defining connection parameters (unicast/multicast, ports, interleaving) .",
      "fuzz_strategy": "Mismatched profiles (e.g., RTP/AVP/TCP with multicast), overlapping port ranges, invalid parameter injection."
    },
    {
      "name": "Range",
      "abnf": "( npt-range | utc-range | smpte-range )",
      "constraint": "Specifies time ranges. Byte ranges MUST NOT be used .",
      "fuzz_strategy": "Invalid NPT formats, start time > end time, mixing time formats, referencing times beyond content duration."
    },
    {
      "name": "interleaved-binary",
      "abnf": "\"$\" channel length binary-data",
      "constraint": "channel (1 byte), length (2 bytes binary), followed by data. No CRLF separation .",
      "fuzz_strategy": "Fuzz the length field to cause buffer over-reads, or inject `$` tokens randomly in text streams."
    }
  ],
  "message_model": [
    {
      "name": "SETUP",
      "type": "Request",
      "structure": {
        "args": [
          "URL"
        ],
        "headers": {
          "required": [
            "CSeq",
            "Transport"
          ],
          "optional": [
            "Authorization",
            "Date",
            "Session",
            "Blocksize"
          ]
        }
      },
      "semantic_rules": [
        {
          "constraint": "Transport header MUST specify transport parameters acceptable to client .",
          "source_ref": "",
          "violation_heuristic": "Omit Transport header or provide empty value."
        },
        {
          "constraint": "If Session ID is included, server MUST bundle into existing session or return 459 .",
          "source_ref": "",
          "violation_heuristic": "Send SETUP with a random/invalid Session ID."
        }
      ],
      "dynamic_dependencies": []
    },
    {
      "name": "PLAY",
      "type": "Request",
      "structure": {
        "args": [
          "URL"
        ],
        "headers": {
          "required": [
            "CSeq",
            "Session"
          ],
          "optional": [
            "Range",
            "Scale",
            "Speed",
            "Bandwidth"
          ]
        }
      },
      "semantic_rules": [
        {
          "constraint": "MUST NOT issue PLAY until SETUP is acknowledged .",
          "source_ref": "",
          "violation_heuristic": "Send PLAY immediately after connection establishment."
        },
        {
          "constraint": "Range header specifies playback range. If missing, play from beginning .",
          "source_ref": "",
          "violation_heuristic": "Provide invalid Range syntax or infinite ranges."
        }
      ],
      "dynamic_dependencies": [
        "Session"
      ]
    },
    {
      "name": "TEARDOWN",
      "type": "Request",
      "structure": {
        "args": [
          "URL"
        ],
        "headers": {
          "required": [
            "CSeq",
            "Session"
          ],
          "optional": []
        }
      },
      "semantic_rules": [
        {
          "constraint": "Frees resources associated with the stream .",
          "source_ref": "",
          "violation_heuristic": "Send TEARDOWN twice for same session (Double Free testing)."
        }
      ],
      "dynamic_dependencies": [
        "Session"
      ]
    },
    {
      "name": "DESCRIBE",
      "type": "Request",
      "structure": {
        "args": [
          "URL"
        ],
        "headers": {
          "required": [
            "CSeq",
            "Accept"
          ],
          "optional": [
            "Authorization"
          ]
        }
      },
      "semantic_rules": [
        {
          "constraint": "Accept header SHOULD specify description formats (e.g., application/sdp) .",
          "source_ref": "",
          "violation_heuristic": "Send DESCRIBE without Accept header or with incompatible MIME types."
        }
      ],
      "dynamic_dependencies": []
    }
  ],
  "state_machine": {
    "states": [
      "Init",
      "Ready",
      "Playing",
      "Recording"
    ],
    "transitions": [
      {
        "from": "Init",
        "trigger": "SETUP",
        "condition": "200 OK",
        "to": "Ready",
        "source_ref": ""
      },
      {
        "from": "Ready",
        "trigger": "PLAY",
        "condition": "200 OK",
        "to": "Playing",
        "source_ref": ""
      },
      {
        "from": "Playing",
        "trigger": "PAUSE",
        "condition": "200 OK",
        "to": "Ready",
        "source_ref": ""
      },
      {
        "from": "Playing",
        "trigger": "TEARDOWN",
        "condition": "200 OK",
        "to": "Init",
        "source_ref": ""
      },
      {
        "from": "Ready",
        "trigger": "TEARDOWN",
        "condition": "200 OK",
        "to": "Init",
        "source_ref": ""
      },
      {
        "from": "Ready",
        "trigger": "RECORD",
        "condition": "200 OK",
        "to": "Recording",
        "source_ref": ""
      },
      {
        "from": "Recording",
        "trigger": "PAUSE",
        "condition": "200 OK",
        "to": "Ready",
        "source_ref": ""
      }
    ]
  }
}
