{
    "meta": {
      "protocol": "SIP (Session Initiation Protocol)",
      "rfc_source": "RFC 3261"
    },
    "constants": {
      "transport": [
        "UDP",
        "TCP",
        "TLS",
        "SCTP"
      ],
      "default_port": 5060,
      "secure_port": 5061,
      "delimiters": [
        "<CRLF>",
        "<SP>",
        ":",
        ";",
        ","
      ],
      "magic_bytes": [
        "SIP/2.0",
        "z9hG4bK"
      ],
      "methods": [
        "REGISTER",
        "INVITE",
        "ACK",
        "CANCEL",
        "BYE",
        "OPTIONS"
      ]
    },
    "syntax_definitions": [
      {
        "name": "Request-Line",
        "abnf": "Method SP Request-URI SP SIP-Version CRLF",
        "constraint": "SIP-Version must be literal 'SIP/2.0' (case-insensitive but uppercase recommended). [cite: 424, 432]",
        "fuzz_strategy": "Injecting invalid versions (SIP/3.0), method confusion, URI scheme flooding."
      },
      {
        "name": "SIP-URI",
        "abnf": "sip:user:password@host:port;uri-parameters?headers",
        "constraint": "Must not contain unescaped spaces or control characters. [cite: 428]",
        "fuzz_strategy": "Parameter injection, scheme confusion (sips vs sip), null byte injection in userinfo."
      },
      {
        "name": "Via-Branch",
        "abnf": "branch=z9hG4bK<token>",
        "constraint": "Must start with magic cookie 'z9hG4bK' to indicate RFC 3261 compliance. Must be globally unique. ",
        "fuzz_strategy": "Omitting magic cookie to force RFC 2543 fallback logic, reusing branch IDs to cause loop detection errors."
      },
      {
        "name": "Call-ID",
        "abnf": "word ['@' word]",
        "constraint": "Globally unique identifier. Case-sensitive. [cite: 574, 579]",
        "fuzz_strategy": "Collision attacks, extremely long ID strings to test buffer limits."
      },
      {
        "name": "CSeq",
        "abnf": "1*DIGIT LWS Method",
        "constraint": "Sequence number must be 32-bit unsigned integer < 2**31. Method must match the request method. [cite: 584, 586]",
        "fuzz_strategy": "Integer overflow (> 2^32), Method mismatch (e.g., '1 INVITE' in a BYE request)."
      }
    ],
    "message_model": [
      {
        "name": "INVITE",
        "type": "Request",
        "structure": {
          "headers": {
            "required": [
              "Via",
              "Max-Forwards",
              "To",
              "From",
              "Call-ID",
              "CSeq",
              "Contact"
            ],
            "optional": [
              "Subject",
              "Content-Type",
              "Content-Length",
              "Allow",
              "Supported"
            ]
          }
        },
        "semantic_rules": [
          {
            "constraint": "Contact header is mandatory in INVITE to establish a dialog. [cite: 612]",
            "source_ref": "[cite: 612]",
            "violation_heuristic": "Omit Contact header to test UAS error handling (expect 400 Bad Request)."
          },
          {
            "constraint": "Max-Forwards should be 70. [cite: 593]",
            "source_ref": "[cite: 593]",
            "violation_heuristic": "Set to 0 to trigger immediate 483 Too Many Hops response."
          },
          {
            "constraint": "If body is present, Content-Type and Content-Length are mandatory (implicit). [cite: 499, 504]",
            "source_ref": "[cite: 499]",
            "violation_heuristic": "Send body without Content-Length in TCP to desynchronize stream."
          }
        ],
        "dynamic_dependencies": [
          "Generate new Call-ID",
          "Generate new From-Tag"
        ]
      },
      {
        "name": "ACK",
        "type": "Request",
        "structure": {
          "headers": {
            "required": [
              "Via",
              "Max-Forwards",
              "To",
              "From",
              "Call-ID",
              "CSeq"
            ]
          }
        },
        "semantic_rules": [
          {
            "constraint": "CSeq method must be ACK, sequence number must match the INVITE. [cite: 1316]",
            "source_ref": "[cite: 1316]",
            "violation_heuristic": "Mismatched sequence number."
          }
        ],
        "dynamic_dependencies": [
          "Must copy Call-ID from INVITE [cite: 1315]",
          "Must copy From-Tag from INVITE [cite: 1315]",
          "Must copy To-Tag from the 2xx Response [cite: 1315]"
        ]
      },
      {
        "name": "BYE",
        "type": "Request",
        "structure": {
          "headers": {
            "required": [
              "Via",
              "Max-Forwards",
              "To",
              "From",
              "Call-ID",
              "CSeq"
            ]
          }
        },
        "semantic_rules": [
          {
            "constraint": "Must not be sent outside of a dialog. [cite: 1442]",
            "source_ref": "[cite: 1442]",
            "violation_heuristic": "Send BYE without prior INVITE/200OK exchange."
          },
          {
            "constraint": "Must contain matching Dialog IDs (To tag, From tag, Call-ID). [cite: 1466]",
            "source_ref": "[cite: 1466]",
            "violation_heuristic": "Spoof BYE with correct Call-ID but wrong Tags to test Hijacking protection."
          }
        ],
        "dynamic_dependencies": [
          "Call-ID (from Dialog)",
          "Local Tag (From Dialog)",
          "Remote Tag (From Dialog)"
        ]
      },
      {
        "name": "REGISTER",
        "type": "Request",
        "structure": {
          "headers": {
            "required": [
              "Via",
              "Max-Forwards",
              "To",
              "From",
              "Call-ID",
              "CSeq"
            ],
            "optional": [
              "Contact",
              "Expires",
              "Authorization"
            ]
          }
        },
        "semantic_rules": [
          {
            "constraint": "Record-Route header has no meaning and must be ignored. [cite: 907]",
            "source_ref": "[cite: 907]",
            "violation_heuristic": "Inject Record-Route to test for logic flaws in stateless registrars."
          },
          {
            "constraint": "Request-URI must not contain userinfo or '@'. [cite: 911]",
            "source_ref": "[cite: 911]",
            "violation_heuristic": "Include userinfo in Request-URI (e.g., sip:user@domain instead of sip:domain)."
          }
        ],
        "dynamic_dependencies": [
          "Call-ID (should persist across refreshes) [cite: 917]"
        ]
      }
    ],
    "state_machine": {
      "states": [
        "NULL",
        "EARLY (Provisional)",
        "CONFIRMED (Established)",
        "TERMINATED"
      ],
      "transitions": [
        {
          "from": "NULL",
          "trigger": "INVITE",
          "condition": "Send Request",
          "to": "EARLY (Provisional)",
          "source_ref": "[cite: 1100]"
        },
        {
          "from": "EARLY (Provisional)",
          "trigger": "Receive 1xx",
          "condition": "Response Code 101-199",
          "to": "EARLY (Provisional)",
          "source_ref": "[cite: 1097]"
        },
        {
          "from": "EARLY (Provisional)",
          "trigger": "Receive 2xx",
          "condition": "Response Code 200-299",
          "to": "CONFIRMED (Established)",
          "source_ref": "[cite: 1097, 1307]"
        },
        {
          "from": "EARLY (Provisional)",
          "trigger": "Receive 300-699",
          "condition": "Final Failure Response",
          "to": "TERMINATED",
          "source_ref": "[cite: 1302]"
        },
        {
          "from": "CONFIRMED (Established)",
          "trigger": "Send ACK",
          "condition": "Ack for 2xx",
          "to": "CONFIRMED (Established)",
          "source_ref": "[cite: 1244]"
        },
        {
          "from": "CONFIRMED (Established)",
          "trigger": "BYE",
          "condition": "Send or Receive",
          "to": "TERMINATED",
          "source_ref": "[cite: 1445]"
        }
      ]
    }
  }